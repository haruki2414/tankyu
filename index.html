<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Firebase åœ°å›³æ²ç¤ºæ¿</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
  body { margin: 0; }
  #map { height: 100vh; }
  textarea { width: 200px; height: 60px; }
</style>
</head>
<body>

<div id="map"></div>

<script>
/* ğŸ”¥ Firebaseè¨­å®šï¼ˆè‡ªåˆ†ã®ã«ç½®ãæ›ãˆï¼‰ */
const firebaseConfig = {
Â  apiKey: "AIzaSyCe_0TVZeUqhxjd7UFflZ-dUamIehU7KWA",
Â  authDomain: "tankyu-6db3a.firebaseapp.com",
Â  projectId: "tankyu-6db3a",
Â  storageBucket: "tankyu-6db3a.firebasestorage.app",
Â  messagingSenderId: "127226146209",
Â  appId: "1:127226146209:web:8b20840d3a325191c86fe0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ğŸ—ºï¸ åœ°å›³ */
const map = L.map("map").setView([35.681236, 139.767125], 13);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

/* ğŸ“¥ Firestoreã‹ã‚‰æŠ•ç¨¿å–å¾— */
db.collection("posts").onSnapshot(snapshot => {
  snapshot.docChanges().forEach(change => {
    if (change.type === "added") {
      const data = change.doc.data();
      L.marker([data.lat, data.lng])
        .addTo(map)
        .bindPopup(data.text);
    }
  });
});

/* ğŸ–±ï¸ åœ°å›³ã‚¯ãƒªãƒƒã‚¯ */
map.on("click", e => {
  const popup = `
    <textarea id="text"></textarea><br>
    <button onclick="savePost(${e.latlng.lat}, ${e.latlng.lng})">
      æŠ•ç¨¿
    </button>
  `;
  L.popup().setLatLng(e.latlng).setContent(popup).openOn(map);
});

/* ğŸ’¾ æŠ•ç¨¿ä¿å­˜ */
function savePost(lat, lng) {
  const text = document.getElementById("text").value;
  if (!text) return;

  db.collection("posts").add({
    lat: lat,
    lng: lng,
    text: text,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  map.closePopup();
}
</script>

</body>
</html>
